---
import type { CollectionEntry } from 'astro:content'
import type { GetStaticPaths } from 'astro'
import MarkdownLayout from '@/layouts/MarkdownLayout.astro'
import MarkdownWrapper from '@/components/MarkdownWrapper.astro'

import SectionBlock from '@/components/SectionBlock.astro'
import { PostToc } from '@/components/post/PostToc'
import { ReadingProgress } from '@/components/post/ReadingProgress'
import { ActionAside } from '@/components/post/ActionAside'

// 获取所有 projects
import { getCollection } from 'astro:content'

export const getStaticPaths = (async () => {
  const projects = await getCollection('projects')
  return projects.map(project => ({
    params: { slug: project.slug },
    props: { current: project },
  }))
}) satisfies GetStaticPaths

interface Props {
  current: CollectionEntry<'projects'>
}

const { current } = Astro.props
// const { Content } = await current.render()
const { headings, Content, remarkPluginFrontmatter } = await current.render()

const mdSlug = `/projects/${current.slug}`
---

<MarkdownLayout
  title={current.data.title}
  description={current.data.description}
  image={current.data.image}
  mdTitle={current.data.title}
  mdDescription={current.data.category}
  mdSlug={mdSlug}
>
  <!-- <div class="max-w-4xl mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold mb-4">{current.data.title}</h1>
    <p class="text-gray-600 mb-6">{current.data.description}</p>
    <img src={current.data.image} alt={current.data.title} class="mb-6 w-full object-cover rounded-lg" />

    <MarkdownWrapper>
      <Content />
    </MarkdownWrapper>
  </div>

  <div class="hidden lg:block" data-pagefind-ignore>
    <aside class="sticky top-20">
      <SectionBlock title="目录">
        <PostToc headings={headings} client:idle />
        <hr class="my-2 border-primary max-w-[100px]" />
        <ReadingProgress client:idle />
      </SectionBlock>
    </aside>
  </div> -->

  <div class="max-w-[1100px] mx-auto px-4 md:px-8 py-16 grid lg:grid-cols-[auto_260px] gap-8" data-pagefind-body>
    <div>
      <header class="space-y-4">
        <h1 class="text-4xl font-bold text-center">
          {current.data.title}
        </h1>
      </header>
    </div>
    <div class="col-start-1 min-w-0">
      <MarkdownWrapper>
        <Content />
      </MarkdownWrapper>
    </div>

    <div class="hidden lg:block" data-pagefind-ignore>
      <aside class="sticky top-20">
        <SectionBlock title="目录">
          <PostToc headings={headings} client:idle />
          <hr class="my-2 border-primary max-w-[100px]" />
          <ReadingProgress client:idle />
        </SectionBlock>

        <ActionAside client:idle />
      </aside>
    </div>
    
  </div>
  
</MarkdownLayout>
